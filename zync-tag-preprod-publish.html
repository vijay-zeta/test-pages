<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>clearIdentified demo</title>
  </head>
  <body>
    <script>
      (function () {
        // Extract all query params into an object
        const params = Object.fromEntries(
          new URLSearchParams(window.location.search).entries()
        );

        // Template with placeholders
        const snippetTemplate = `
          function zync_call() {
            var z = document.createElement("script");
            var gpp = "";
            var gpp_sid = "";
            var gdpr = "";
            var gdpr_consent = "";
            var zmpID = "vijay-sandbox";
            var cache_buster = Date.now();
            var PageUrl = encodeURIComponent(window.top.location.href)
              .replace(/[!'()~]/g, escape)
              .replace(/\*/g, "%2A"); 
            // This macro contains JavaScript that is compatible with most web browsers.
            // If your deployment uses a tag manager, please ensure compatibility with your specific implementation

            var z_src =
              "https://zync-kafka-external.dev.zetaglobal.io/sync" +
              "?c=16b6410431b6374e780104abb0443ca8" +
              "&p=cf8c608688e49da8b728ca1f02a09f0d" +
              "&k=vijay-sandbox-pixel-6621" +
              "&gpp=" + gpp +
              "&gpp_sid=" + gpp_sid +
              "&gdpr=" + gdpr +
              "&gdpr_consent=" + gdpr_consent +
              "&zmpID=" + zmpID +
              "&cache_buster=" + cache_buster +
              "&PageUrl=" + PageUrl;

            z.setAttribute("src", z_src);
            document.body.appendChild(z);
          }

          if (["complete", "interactive"].indexOf(document.readyState) >= 0) {
            zync_call();
          } else {
            window.addEventListener("DOMContentLoaded", zync_call);
          }
        `;

        // Replace placeholders in the template with query param values
        const finalSnippet = Object.entries(params).reduce((tpl, [key, value]) => {
          const placeholder = new RegExp(`\\{${key}\\}`, "g"); // global replace
          return tpl.replace(placeholder, value);
        }, snippetTemplate);

        // Inject and execute the script
        const script = document.createElement("script");
        script.textContent = finalSnippet;
        document.body.appendChild(script);
      })();
    </script>
  </body>
</html>
